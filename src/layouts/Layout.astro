---
import '../styles/global.css'
import EstimateModal from '../components/EstimateModal.astro';
import LocalBusinessSchema from '../components/schema/LocalBusinessSchema.astro';
import WebPageSchema from '../components/schema/WebPageSchema.astro';
import { schemaData, getOpeningHoursSpecification, getSameAsLinks } from '../data/schema';

interface Props {
  title: string;
  description?: string;
  robots?: string;
}

const {
  title,
  description = "Transform your space with Clean Cut's professional painting and handyman services in Decatur and Springfield IL. Interior & exterior painting, cabinet refinishing, deck staining. Free estimates!",
  robots
} = Astro.props;

// Prepare schema data for LocalBusinessSchema component
const businessSchemaProps = {
  businessName: schemaData.business.name,
  description: schemaData.business.description,
  url: schemaData.contact.website,
  logo: `${schemaData.contact.website}/logo.webp`,
  image: `${schemaData.contact.website}/images/hero.webp`,
  priceRange: schemaData.schema.price_range,
  locations: schemaData.locations.map(loc => ({
    name: loc.name,
    streetAddress: loc.streetAddress,
    city: loc.city,
    state: loc.state,
    postalCode: loc.postalCode,
    country: loc.country,
    telephone: loc.telephone,
    latitude: loc.latitude,
    longitude: loc.longitude
  })),
  openingHours: getOpeningHoursSpecification(schemaData.hours),
  sameAs: getSameAsLinks(schemaData.social),
  areaServed: schemaData.service_areas.primary.map(area => `${area.name}, ${area.state}`)
};
---

<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Tag Manager -->
  <script is:inline>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-T2C2X45V');</script>
  <!-- End Google Tag Manager -->
  <!-- Google tag (gtag.js) -->
  <script is:inline async src="https://www.googletagmanager.com/gtag/js?id=G-3E2WKQMM5X"></script>
  <script is:inline>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3E2WKQMM5X');
  </script>
  <meta charset="UTF-8" />
  <link rel="preload" as="image" href="/images/CleanCut Image-3-mobile.webp" imagesrcset="/images/CleanCut Image-3-mobile.webp 640w, /images/CleanCut Image-3-tablet.webp 1024w, /images/CleanCut Image-3.webp 1600w" imagesizes="100vw" type="image/webp" fetchpriority="high" />
  <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <meta name="google-site-verification" content="vkBXOZH12j-RM2eMzRVJQSlp1B2CF0QHYECTYZBkc_E" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{title}</title>
  <meta name="description" content={description} />
  {robots && <meta name="robots" content={robots} />}
  <link rel="canonical" href={`${schemaData.contact.website}${Astro.url.pathname}`} />
  
  <!-- Open Graph -->
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:type" content="website" />
  <meta property="og:url" content={`${schemaData.contact.website}${Astro.url.pathname}`} />
  <meta property="og:image" content={`${schemaData.contact.website}/images/CleanCut Image-3.webp`} />
  <meta property="og:site_name" content="Clean Cut Painting & Handyman" />
  <meta property="og:locale" content="en_US" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={`${schemaData.contact.website}/images/CleanCut Image-3.webp`} />
  
  <!-- Geo SEO -->
  <meta name="geo.region" content="US-IL" />
  <meta name="geo.placename" content="Decatur, Illinois" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=PT+Sans:wght@400;700&display=swap" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=PT+Sans:wght@400;700&display=swap"></noscript>
  
  <!-- Structured Data: LocalBusiness -->
  <LocalBusinessSchema {...businessSchemaProps} />
  <WebPageSchema name={title} description={description} url={`${schemaData.contact.website}${Astro.url.pathname}`} />
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T2C2X45V"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  <div class="min-h-screen bg-white">
    <slot />
  </div>
  <EstimateModal />
  
  <!-- reCAPTCHA v3 - Lazy loaded on user interaction for better CWV -->
  <script is:inline>
    (function() {
      var loaded = false;
      function loadRecaptcha() {
        if (loaded) return;
        loaded = true;
        var s = document.createElement('script');
        s.src = 'https://www.google.com/recaptcha/api.js?render=6LeBhlArAAAAAK4QNqNpQmU3g0YBnviLRoFk6kqw';
        s.onload = function() {
          var s2 = document.createElement('script');
          s2.src = '/js/grecaptchav3.js';
          document.head.appendChild(s2);
        };
        document.head.appendChild(s);
        ['mousemove','scroll','keydown','touchstart','click'].forEach(function(e) {
          document.removeEventListener(e, loadRecaptcha);
        });
      }
      ['mousemove','scroll','keydown','touchstart','click'].forEach(function(e) {
        document.addEventListener(e, loadRecaptcha, { once: true, passive: true });
      });
    })();
  </script>
</body>
</html>
