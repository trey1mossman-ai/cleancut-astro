---
/**
 * LocalBusinessSchema.astro
 * Generates JSON-LD structured data for LocalBusiness schema
 * Supports multiple locations with separate schema entries
 * ALL data comes from props - NO hardcoded business values
 */

interface Location {
  name?: string;
  streetAddress: string;
  city: string;
  state: string;
  postalCode: string;
  country?: string;
  telephone: string;
  latitude?: number;
  longitude?: number;
}

interface Props {
  businessName: string;
  description: string;
  url: string;
  logo?: string;
  image?: string;
  priceRange?: string;
  locations: Location[];
  openingHours?: string[];
  sameAs?: string[];
  areaServed?: string[];
}

const {
  businessName,
  description,
  url,
  logo,
  image,
  priceRange = '$$',
  locations,
  openingHours,
  sameAs,
  areaServed
} = Astro.props;

// Build schema for each location
const schemas = locations.map((location, index) => ({
  '@context': 'https://schema.org',
  '@type': ['LocalBusiness', 'HomeAndConstructionBusiness', 'HousePainter', 'HandymanService'],
  '@id': index === 0 ? `${url}#business` : `${url}#business-${location.city?.toLowerCase()}`,
  name: location.name ? `${businessName} - ${location.name}` : businessName,
  description: description,
  url: url,
  ...(logo && { logo: logo }),
  ...(image && { image: image }),
  priceRange: priceRange,
  address: {
    '@type': 'PostalAddress',
    streetAddress: location.streetAddress,
    addressLocality: location.city,
    addressRegion: location.state,
    postalCode: location.postalCode,
    addressCountry: location.country || 'US'
  },
  telephone: location.telephone,
  ...(location.latitude && location.longitude && {
    geo: {
      '@type': 'GeoCoordinates',
      latitude: location.latitude,
      longitude: location.longitude
    }
  }),
  ...(openingHours && openingHours.length > 0 && {
    openingHoursSpecification: openingHours
  }),
  ...(sameAs && sameAs.length > 0 && { sameAs: sameAs }),
  ...(areaServed && areaServed.length > 0 && { areaServed: areaServed })
}));
---

{schemas.map(schema => (
  <script type="application/ld+json" set:html={JSON.stringify(schema, null, 2)} />
))}
