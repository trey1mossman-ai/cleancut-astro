---
interface Step {
  number: number;
  title: string;
  description: string;
}

interface Props {
  steps: Step[];
  title?: string;
}

const { steps, title = "Our Process in a Snapshot" } = Astro.props;
---

<section class="py-16 relative overflow-hidden" style="background-image: url('/patterns/pattern-04.webp'); background-size: cover; background-position: center;">
  <div class="absolute inset-0 bg-[#144787]/90"></div>
  <div class="relative z-10">
    <div class="container-custom">
      <h2 class="text-3xl lg:text-4xl font-display font-bold text-center text-white mb-4">
        {title}
      </h2>
      <p class="text-white/70 text-center mb-12 max-w-2xl mx-auto">
        Our proven approach ensures exceptional results every time
      </p>
    </div>

    <!-- Horizontal Scroll Container -->
    <div class="process-scroll-container relative">
      <div class="process-scroll-track flex gap-6 px-6 md:px-12 pb-6 overflow-x-auto scroll-smooth snap-x snap-mandatory" style="scrollbar-width: none; -ms-overflow-style: none;">
        {steps.map((step, index) => (
          <div 
            class="process-card flex-shrink-0 w-[300px] md:w-[340px] bg-white rounded-2xl shadow-2xl p-8 snap-center transform transition-all duration-500 hover:scale-[1.02] hover:shadow-3xl"
            style={`animation-delay: ${index * 100}ms;`}
          >
            <!-- Step Number Badge -->
            <div class="flex items-center gap-4 mb-6">
              <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-sky-400 to-sky-500 text-white flex items-center justify-center text-2xl font-bold shadow-lg">
                {step.number}
              </div>
              <div class="h-1 flex-1 bg-gradient-to-r from-sky-400/50 to-transparent rounded-full"></div>
            </div>
            
            <!-- Content -->
            <h3 class="text-xl font-bold text-[#144787] mb-4 leading-tight">
              {step.title}
            </h3>
            <p class="text-gray-600 leading-relaxed">
              {step.description}
            </p>
            
            <!-- Progress indicator -->
            <div class="mt-6 flex items-center gap-2">
              <span class="text-xs font-semibold text-sky-400">Step {step.number}</span>
              <span class="text-xs text-gray-400">of {steps.length}</span>
            </div>
          </div>
        ))}
        
        <!-- Spacer for last card visibility -->
        <div class="flex-shrink-0 w-6 md:w-12"></div>
      </div>

      <!-- Scroll Indicators -->
      <div class="flex justify-center gap-2 mt-6">
        {steps.map((_, index) => (
          <button 
            class="scroll-indicator w-2 h-2 rounded-full bg-white/30 transition-all duration-300 hover:bg-white/60"
            data-index={index}
            aria-label={`Go to step ${index + 1}`}
          ></button>
        ))}
      </div>

      <!-- Scroll hint for mobile -->
      <p class="text-white/50 text-sm text-center mt-4 md:hidden flex items-center justify-center gap-2">
        <svg class="w-4 h-4 animate-bounce-x" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
        </svg>
        Swipe to explore
      </p>
    </div>
  </div>
</section>

<style>
  .process-scroll-track::-webkit-scrollbar {
    display: none;
  }
  
  .process-card {
    animation: fadeSlideIn 0.6s ease-out forwards;
    opacity: 0;
    transform: translateY(20px);
  }
  
  @keyframes fadeSlideIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes bounce-x {
    0%, 100% {
      transform: translateX(0);
    }
    50% {
      transform: translateX(4px);
    }
  }
  
  .animate-bounce-x {
    animation: bounce-x 1s ease-in-out infinite;
  }
  
  .scroll-indicator.active {
    background-color: rgba(255, 255, 255, 0.9);
    width: 1.5rem;
  }

  /* Desktop: Center cards if they fit */
  @media (min-width: 1200px) {
    .process-scroll-track {
      justify-content: center;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const track = document.querySelector('.process-scroll-track');
    const indicators = document.querySelectorAll('.scroll-indicator');
    const cards = document.querySelectorAll('.process-card');
    
    if (!track || !indicators.length) return;
    
    // Update active indicator on scroll
    const updateIndicators = () => {
      const scrollLeft = track.scrollLeft;
      const cardWidth = cards[0]?.offsetWidth || 340;
      const gap = 24; // gap-6 = 1.5rem = 24px
      const activeIndex = Math.round(scrollLeft / (cardWidth + gap));
      
      indicators.forEach((ind, i) => {
        ind.classList.toggle('active', i === activeIndex);
      });
    };
    
    track.addEventListener('scroll', updateIndicators, { passive: true });
    
    // Click indicator to scroll to card
    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => {
        const cardWidth = cards[0]?.offsetWidth || 340;
        const gap = 24;
        track.scrollTo({
          left: index * (cardWidth + gap),
          behavior: 'smooth'
        });
      });
    });
    
    // Initialize
    updateIndicators();
    
    // Trigger card animations when in view
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.animationPlayState = 'running';
        }
      });
    }, { threshold: 0.2 });
    
    cards.forEach(card => {
      card.style.animationPlayState = 'paused';
      observer.observe(card);
    });
  });
</script>
