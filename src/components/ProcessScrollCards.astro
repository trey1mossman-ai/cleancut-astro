---
interface Step {
  number: number;
  title: string;
  description: string;
}

interface Props {
  steps: Step[];
  title?: string;
}

const { steps, title = "Our Process" } = Astro.props;
---

<section class="py-16 relative overflow-hidden" style="background-image: url('/patterns/pattern-04.webp'); background-size: cover; background-position: center;">
  <div class="absolute inset-0 bg-[#144787]/90"></div>
  <div class="relative z-10">
    <!-- Header -->
    <div class="container-custom mb-10">
      <h2 class="text-3xl lg:text-4xl font-display font-bold text-center text-white mb-3">
        {title}
      </h2>
      <p class="text-white/70 text-center max-w-2xl mx-auto">
        Turning Your Vision into Reality
      </p>
    </div>

    <!-- Cards Container -->
    <div class="process-container max-w-7xl mx-auto px-4">
      <!-- Cards Grid - shows 4 on desktop, scrolls to 5th -->
      <div class="process-track flex gap-4 overflow-x-auto pb-2 cursor-grab active:cursor-grabbing">
        {steps.map((step) => (
          <article class="process-card flex-none w-[calc(25%-12px)] min-w-[260px] bg-white rounded-xl shadow-xl p-6">
            <!-- Step Number -->
            <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-sky-400 to-sky-500 text-white flex items-center justify-center text-xl font-bold shadow-md mb-5">
              {step.number}
            </div>
            
            <!-- Content -->
            <h3 class="text-lg font-bold text-[#144787] mb-3 leading-snug">
              {step.title}
            </h3>
            <p class="text-gray-600 text-sm leading-relaxed">
              {step.description}
            </p>
          </article>
        ))}
      </div>

      <!-- Scroll Button -->
      <div class="flex justify-center mt-6">
        <button 
          class="scroll-more-btn flex items-center gap-2 px-5 py-2.5 bg-white/10 hover:bg-white/20 border border-white/30 rounded-full text-white text-sm font-medium transition-all duration-300 group"
          aria-label="See more steps"
        >
          <span class="btn-text">See Step 5</span>
          <svg class="w-4 h-4 transition-transform duration-300 group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>
</section>

<style>
  /* Hide scrollbar */
  .process-track {
    scrollbar-width: none;
    -ms-overflow-style: none;
    scroll-behavior: smooth;
  }
  .process-track::-webkit-scrollbar {
    display: none;
  }
  
  .process-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .process-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.25);
  }
  
  /* Responsive card widths */
  @media (max-width: 1200px) {
    .process-card {
      width: calc(33.333% - 11px);
      min-width: 240px;
    }
  }
  @media (max-width: 900px) {
    .process-card {
      width: calc(50% - 8px);
      min-width: 220px;
    }
  }
  @media (max-width: 600px) {
    .process-card {
      width: 85%;
      min-width: 260px;
    }
  }
</style>

<script>
  function initProcessCards() {
    const track = document.querySelector('.process-track') as HTMLElement;
    const btn = document.querySelector('.scroll-more-btn') as HTMLElement;
    const btnText = btn?.querySelector('.btn-text') as HTMLElement;
    const cards = document.querySelectorAll('.process-card');
    
    if (!track || !btn || !cards.length) return;
    
    let atEnd = false;
    
    // Mouse drag scrolling
    let isDown = false;
    let startX: number;
    let scrollLeft: number;
    
    track.addEventListener('mousedown', (e) => {
      isDown = true;
      track.style.cursor = 'grabbing';
      startX = e.pageX - track.offsetLeft;
      scrollLeft = track.scrollLeft;
    });
    
    track.addEventListener('mouseleave', () => {
      isDown = false;
      track.style.cursor = 'grab';
    });
    
    track.addEventListener('mouseup', () => {
      isDown = false;
      track.style.cursor = 'grab';
    });
    
    track.addEventListener('mousemove', (e) => {
      if (!isDown) return;
      e.preventDefault();
      const x = e.pageX - track.offsetLeft;
      const walk = (x - startX) * 2;
      track.scrollLeft = scrollLeft - walk;
    });
    
    // Update button state based on scroll position
    const updateButton = () => {
      const maxScroll = track.scrollWidth - track.clientWidth;
      atEnd = track.scrollLeft >= maxScroll - 10;
      
      if (atEnd) {
        btnText.textContent = 'Back to Start';
        btn.querySelector('svg')?.classList.add('rotate-180');
      } else {
        btnText.textContent = 'See Step 5';
        btn.querySelector('svg')?.classList.remove('rotate-180');
      }
    };
    
    track.addEventListener('scroll', updateButton, { passive: true });
    
    // Button click - scroll to end or back to start
    btn.addEventListener('click', () => {
      if (atEnd) {
        track.scrollTo({ left: 0, behavior: 'smooth' });
      } else {
        track.scrollTo({ left: track.scrollWidth, behavior: 'smooth' });
      }
    });
    
    // Initialize
    updateButton();
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProcessCards);
  } else {
    initProcessCards();
  }
</script>
