---
interface FAQ {
  question: string;
  answer: string;
}

interface Props {
  faqs: FAQ[];
  title?: string;
  videoSrc: string;
  videoThumbnail: string;
  videoTitle?: string;
}

const { faqs, title = "Frequently Asked Questions", videoSrc, videoThumbnail, videoTitle = "Watch Our Work" } = Astro.props;

// VideoObject schema data
const videoSchema = {
  "@context": "https://schema.org",
  "@type": "VideoObject",
  "name": videoTitle,
  "description": `${videoTitle} - Professional painting and handyman services by Clean Cut in Decatur and Springfield, IL`,
  "thumbnailUrl": `https://cleancutservice.com${videoThumbnail}`,
  "contentUrl": videoSrc,
  "uploadDate": "2026-01-01T00:00:00-06:00",
  "duration": "PT2M",
  "publisher": {
    "@type": "Organization",
    "name": "Clean Cut Painting & Handyman",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cleancutservice.com/logo.webp"
    }
  }
};
---

<!-- VideoObject Schema -->
<script type="application/ld+json" set:html={JSON.stringify(videoSchema, null, 2)} />

<section class="py-16 bg-gray-50">
  <div class="container-custom">
    <div class="grid lg:grid-cols-2 gap-12 items-start">
      <!-- Video Column (Left) -->
      <div class="lg:sticky lg:top-24">
        <div 
          class="video-card group relative aspect-video rounded-xl overflow-hidden shadow-2xl cursor-pointer"
          data-video-src={videoSrc}
        >
          <!-- Thumbnail -->
          <img
            src={videoThumbnail}
            alt={`${videoTitle} - Watch video`}
            class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
            loading="lazy"
            width="640"
            height="360"
          />
          
          <!-- Gradient overlay -->
          <div class="video-overlay absolute inset-0 bg-gradient-to-t from-[#144787]/90 via-[#144787]/30 to-transparent opacity-80 group-hover:opacity-90 transition-opacity duration-300"></div>
          
          <!-- Play button -->
          <div class="play-btn-container absolute inset-0 flex items-center justify-center">
            <div class="play-btn w-20 h-20 bg-white/95 rounded-full flex items-center justify-center shadow-2xl transform group-hover:scale-110 transition-all duration-300 group-hover:bg-sky-500">
              <svg class="w-8 h-8 text-[#144787] group-hover:text-white ml-1 transition-colors duration-300" fill="currentColor" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"/>
              </svg>
            </div>
          </div>
          
          <!-- Title -->
          <div class="video-title absolute bottom-0 left-0 right-0 p-5">
            <h3 class="text-white font-display font-bold text-lg drop-shadow-lg">
              {videoTitle}
            </h3>
          </div>
          
          <!-- Video container (hidden until clicked) -->
          <div class="video-container absolute inset-0 hidden bg-black">
            <video 
              class="w-full h-full object-cover" 
              controls 
              preload="none"
              playsinline
            >
              <source src={videoSrc} type="video/mp4" />
            </video>
          </div>
          
          <!-- Loading spinner -->
          <div class="loading-spinner absolute inset-0 hidden items-center justify-center bg-[#144787]/80">
            <div class="w-12 h-12 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
          </div>
        </div>
        
        <p class="text-center text-gray-500 text-sm mt-4">Click to play video</p>
      </div>

      <!-- FAQ Column (Right) -->
      <div>
        <!-- Header -->
        <div class="mb-8">
          <h2 class="text-3xl lg:text-4xl font-display font-bold text-[#144787] mb-3">
            {title}
          </h2>
          <p class="text-gray-600">
            Get answers to common questions about our services
          </p>
        </div>

        <!-- FAQ List -->
        <div class="faq-container space-y-3">
          {faqs.map((faq, index) => (
            <div 
              class="faq-item bg-white rounded-lg border border-gray-200 overflow-hidden transition-all duration-300"
              data-faq-index={index}
            >
              <button
                class="faq-trigger w-full px-5 py-4 flex items-center justify-between text-left hover:bg-gray-50 transition-colors duration-200"
                aria-expanded="false"
              >
                <span class="text-[#144787] font-semibold pr-4 leading-snug text-sm sm:text-base">
                  {faq.question}
                </span>
                <span class="faq-icon flex-shrink-0 w-6 h-6 rounded-full bg-sky-100 flex items-center justify-center transition-transform duration-300">
                  <svg class="w-4 h-4 text-sky-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </span>
              </button>
              <div class="faq-content hidden px-5 pt-2 pb-5">
                <p class="text-gray-600 leading-relaxed text-sm sm:text-base">
                  {faq.answer}
                </p>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .faq-item {
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .faq-item:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  .faq-trigger[aria-expanded="true"] .faq-icon {
    transform: rotate(180deg);
    background-color: #0ea5e9;
  }

  .faq-trigger[aria-expanded="true"] .faq-icon svg {
    color: white;
  }

  /* Loading spinner animation */
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  .animate-spin {
    animation: spin 1s linear infinite;
  }
</style>

<script>
  function initFAQWithVideo() {
    // FAQ Accordion functionality
    const containers = document.querySelectorAll('.faq-container');

    containers.forEach(container => {
      const triggers = container.querySelectorAll('.faq-trigger');

      triggers.forEach(trigger => {
        trigger.addEventListener('click', () => {
          const content = trigger.nextElementSibling as HTMLElement;
          const isExpanded = trigger.getAttribute('aria-expanded') === 'true';

          // Close all other FAQs in this container
          triggers.forEach(otherTrigger => {
            if (otherTrigger !== trigger) {
              otherTrigger.setAttribute('aria-expanded', 'false');
              const otherContent = otherTrigger.nextElementSibling as HTMLElement;
              if (otherContent) {
                otherContent.classList.add('hidden');
              }
            }
          });

          // Toggle current FAQ
          trigger.setAttribute('aria-expanded', (!isExpanded).toString());
          if (content) {
            content.classList.toggle('hidden', isExpanded);
          }
        });
      });
    });

    // Video card functionality
    const videoCards = document.querySelectorAll('.video-card');

    videoCards.forEach(card => {
      card.addEventListener('click', function(this: HTMLElement) {
        const videoContainer = this.querySelector('.video-container') as HTMLElement;
        const loadingSpinner = this.querySelector('.loading-spinner') as HTMLElement;
        const thumbnail = this.querySelector('img') as HTMLElement;
        const overlay = this.querySelector('.video-overlay') as HTMLElement;
        const playBtnContainer = this.querySelector('.play-btn-container') as HTMLElement;
        const titleArea = this.querySelector('.video-title') as HTMLElement;
        const video = videoContainer?.querySelector('video') as HTMLVideoElement;

        if (!videoContainer || !video) return;

        // If already playing, don't do anything
        if (videoContainer.classList.contains('playing')) return;

        // Show loading spinner
        loadingSpinner?.classList.remove('hidden');
        loadingSpinner?.classList.add('flex');

        // Hide thumbnail, overlay, play button, and title with fade
        thumbnail?.classList.add('opacity-0');
        overlay?.classList.add('opacity-0');
        playBtnContainer?.classList.add('opacity-0', 'scale-75');
        titleArea?.classList.add('opacity-0', 'translate-y-4');

        // Small delay for visual smoothness
        setTimeout(() => {
          // Show video container
          videoContainer.classList.remove('hidden');
          videoContainer.classList.add('playing');

          // Hide loading spinner
          loadingSpinner?.classList.add('hidden');
          loadingSpinner?.classList.remove('flex');

          // Hide other elements completely
          thumbnail?.classList.add('hidden');
          overlay?.classList.add('hidden');
          playBtnContainer?.classList.add('hidden');
          titleArea?.classList.add('hidden');

          // Play the video
          video.play().catch(err => {
            console.log('Autoplay prevented:', err);
          });

          // Remove cursor pointer since video is playing
          (card as HTMLElement).style.cursor = 'default';
        }, 300);

        // When video ends, reset to thumbnail
        video.addEventListener('ended', function() {
          videoContainer.classList.add('hidden');
          videoContainer.classList.remove('playing');

          thumbnail?.classList.remove('hidden', 'opacity-0');
          overlay?.classList.remove('hidden', 'opacity-0');
          playBtnContainer?.classList.remove('hidden', 'opacity-0', 'scale-75');
          titleArea?.classList.remove('hidden', 'opacity-0', 'translate-y-4');

          (card as HTMLElement).style.cursor = 'pointer';
        }, { once: true });
      });
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFAQWithVideo);
  } else {
    initFAQWithVideo();
  }
</script>
